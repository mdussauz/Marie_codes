%function [] = getFirstInhalation(odorStart, zero_crossing)

% temp = zero_crossing - odorStart ;
% temp(temp <0) = inf;
% [closestval,closestIndex] = min(temp);

filename = fullfile('/Users/mdussauz/Desktop/Analysis/2021-01-25_09-35-25','all_channels.events');
% [data, timestamps, info] = load_open_ephys_data(filename); % data has channel IDs
% 
% % adjust for clock offset between open ephys and kilosort
% [offset] = AdjustClockOffset('/Users/mdussauz/Desktop/Analysis/2021-01-25_09-35-25');
% offset = offset/sampleRate;


%% Get Events and correct for ephys offset 
[Events] = ParseOpenEphysEvents(filename);
% trial events are in Channel0, odor events are in Channel1

TrialTimestamps = [Events.Channel0.On Events.Channel0.Off];
TrialTimestamps(1,:) = []; % delete first entry - just an empty trigger
OdorTimestamps = [Events.Channel1.On Events.Channel1.Off];

OdorTimestamps = OdorTimestamps - offset; % adjust for offset 
odorStart = OdorTimestamps(:,1);

zci_times = newTimeBase(zero_crossings);

closest_neighbor_zci = zeros(1, length(odorStart));
for i = 1:length(odorStart)
    dist = zeros(1, length(zci_times));
    for j = 1:length(zci_times)
        dist(j) = zci_times(j) - odorStart(i);
    end
    dist(dist <0) = inf;
    [~,closestIndex] = min(dist);
    closest_neighbor_zci(i) = zci_times(closestIndex);
    closest_neighbor_index(i) = closestIndex;
end


end